{% load i18n static %}
{% load filters %}

{% block head %}
    {% include "base/head.html" %}
{% endblock %}

<title>وبلاگ | {{ThisPost.title}}</title>
</head>

{% block header %}
    {% include "base/header.html" %}
{% endblock %}

<body>
    <div class="container">
        <div class="blog-post">
            <div class="row">
                <div class="col-12">
                    <div class="whole-card text-right">
                        <div class="row">
                            <div class="col-12">
                                <div class="d-flex justify-content-between post-first-row">
                                    <div class="post-title">
                                        <h4>{{ThisPost.title}}</h4>
                                        <!-- {{ThisPost.get_total_points}.} -->
                                    </div>
                                    {% if request.user.is_authenticated %}
                                        <div class="post-rate">
                                            <div class="rating">
                                                <input id="check-5" type="radio" name="rateradio" hidden >
                                                <label for="check-5">
                                                    {% if ThisPost.get_total_points >= 4.5 %}
                                                        <i class="fas fa-star active"></i>
                                                    {% else %}
                                                        <i class="fas fa-star"></i>
                                                    {% endif %}
                                                </label>
                                                <input id="check-4" type="radio" name="rateradio" hidden>
                                                <label for="check-4">
                                                    {% if ThisPost.get_total_points >= 3.5 %}
                                                        <i class="fas fa-star active"></i>
                                                    {% else %}
                                                        <i class="fas fa-star"></i>
                                                    {% endif %}
                                                </label>
                                                <input id="check-3" type="radio" name="rateradio" hidden>
                                                <label for="check-3">
                                                    {% if ThisPost.get_total_points >= 2.5 %}
                                                        <i class="fas fa-star active"></i>
                                                    {% else %}
                                                        <i class="fas fa-star"></i>
                                                    {% endif %}
                                                </label>
                                                <input id="check-2" type="radio" name="rateradio" hidden>
                                                <label for="check-2">
                                                    {% if ThisPost.get_total_points >= 1.5 %}
                                                        <i class="fas fa-star active"></i>
                                                    {% else %}
                                                        <i class="fas fa-star"></i>
                                                    {% endif %}
                                                </label>
                                                <input id="check-1" type="radio" name="rateradio" hidden>
                                                <label for="check-1">
                                                    {% if ThisPost.get_total_points >= 0.5 %}
                                                        <i class="fas fa-star active"></i>
                                                    {% else %}
                                                        <i class="fas fa-star"></i>
                                                    {% endif %}
                                                </label>
                                            </div>
                                        </div>
                                    {% else %}
                                        <div class="post-rate">
                                            {% if ThisPost.get_total_points >= 4.5 %}
                                            <i class="fas fa-star active"></i>
                                            {% else %}
                                            <i class="fas fa-star"></i>
                                            {% endif %}
                                            {% if ThisPost.get_total_points >= 3.5 %}
                                            <i class="fas fa-star active"></i>
                                            {% else %}
                                            <i class="fas fa-star"></i>
                                            {% endif %}
                                            {% if ThisPost.get_total_points >= 2.5 %}
                                            <i class="fas fa-star active"></i>
                                            {% else %}
                                            <i class="fas fa-star"></i>
                                            {% endif %}
                                            {% if ThisPost.get_total_points >= 1.5 %}
                                            <i class="fas fa-star active"></i>
                                            {% else %}
                                            <i class="fas fa-star"></i>
                                            {% endif %}
                                            {% if ThisPost.get_total_points >= 0.5 %}
                                            <i class="fas fa-star active"></i>
                                            {% else %}
                                            <i class="fas fa-star"></i>
                                            {% endif %}
                                        </div>
                                    {% endif %}
                                    <!-- <div class="post-rate">
                                        <div class="rating">
                                            <input id="check-5" type="radio" name="rateradio" hidden >
                                            <label for="check-5">
                                                <i class="fas fa-star"></i>
                                            </label>
                                            <input id="check-4" type="radio" name="rateradio" hidden>
                                            <label for="check-4">
                                                <i class="fas fa-star"></i>
                                            </label>
                                            <input id="check-3" type="radio" name="rateradio" hidden>
                                            <label for="check-3">
                                                <i class="fas fa-star"></i>
                                            </label>
                                            <input id="check-2" type="radio" name="rateradio" hidden>
                                            <label for="check-2">
                                                <i class="fas fa-star"></i>
                                            </label>
                                            <input id="check-1" type="radio" name="rateradio" hidden>
                                            <label for="check-1">
                                                <i class="fas fa-star"></i>
                                            </label>
                                        </div>
                                    </div> -->
                                </div>
                            </div>
                        </div>
                        <div class="post-content">
                            <div class="post-content-text">
                                <div class="post-content-img">
                                    <img src="{{ThisPost.slider_image.url}}" alt="عکس پست وبلاگ">
                                </div>
                                {{ThisPost.description | safe}}
                            </div>
                            <div class="post-date text-left">
                                {{ThisPost.publishdate|to_jalali_month}}
                            </div>
                        </div>

                        <div class="comments">
                            <div class="approved-comments">
                                <h5 class="comment-section-title">نظرات</h5>
                                {% for item in Comments %}
                                    <div class="comment" val="{{item.id}}">
                                        <div class="commenter-user-name">
                                            {{item.FK_User.get_fullname}}
                                        </div>
                                        <div class="comment-date">
                                            {{item.datecreate|to_jalali_month}}
                                        </div>
                                        <div class="comment-main">
                                            {{item.description}}
                                        </div>
                                        <div class="comment-like-reply">
                                            <div class="comment-like">
                                                {{item.likes|length}}
                                                {% if request.user.is_authenticated %}
                                                    <i class="fas fa-thumbs-up"></i>
                                                {% endif %}
                                            </div>
                                            {% if request.user.is_authenticated %}
                                                <div class="comment-reply">
                                                    <button val="{{item.id}}" class="btn btn-secondary reply-btn">
                                                        پاسخ
                                                    </button>
                                                </div>
                                            {% endif %}
                                        </div>
                                        <div class="comment">
                                            <div class="commenter-user-name">
                                                Username
                                            </div>
                                            <div class="comment-date">
                                                25 تیر 1399 ساعت 17:45
                                            </div>
                                            <div class="comment-main">
                                                لورم ایپسوم متن ساختگی با تولید سادگی نامفهوم از صنعت چاپ، و با استفاده از طراحان گرافیک است، چاپگرها و متون بلکه روزنامه و مجله در ستون و سطرآنچنان که لازم است، و برای شرایط فعلی تکنولوژی مورد نیاز، و کاربردهای متنوع با هدف بهبود ابزارهای کاربردی می باشد، کتابهای زیادی در شصت و سه درصد گذشته حال و آینده، شناخت فراوان جامعه و متخصصان را می طلبد، تا با نرم افزارها شناخت بیشتری را برای طراحان رایانه ای علی الخصوص طراحان خلاقی، و فرهنگ پیشرو در زبان فارسی ایجاد کرد، در این صورت می توان امید داشت که تمام و دشواری موجود در ارائه راهکارها، و شرایط سخت تایپ به پایان رسد و زمان مورد نیاز شامل حروفچینی دستاوردهای اصلی، و جوابگوی سوالات پیوسته اهل دنیای موجود طراحی اساسا مورد استفاده قرار گیرد.
                                            </div>
                                        
                                            <div class="comment-like-reply">
                                                <div class="comment-like">
                                                    0
                                                    {% if request.user.is_authenticated %}
                                                        <i class="fas fa-thumbs-up"></i>
                                                    {% endif %}
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                {% endfor %}
                            </div>
                            {% if request.user.is_authenticated %}
                                <div class="comment-form">
                                    <h5>نظر شما</h5>
                                    <p>نظر خود را از طریق بخش زیر برای ما ارسال کنید.</p>
                                    <textarea name="comment" id="product-comment" class="form-control" cols="20" rows="7" placeholder="نظر خود را در اینجا بنویسید..."></textarea>
                                    <div class="send-comment-btn text-left mt-3">
                                        <button class="btn btn-primary send-comment">ارسال</button>
                                    </div>
                                </div>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    {% block footer %}
        {% include "base/footer.html" %}
    {% endblock %}
        
    {% block foot %}
        {% include "base/foot.html" %}
    {% endblock %}

</body>
</html>

<script>
    $(".post-rate input").on('change', function () {
        var postRate = productRateFnc();
        $(".product-rate").find('i').removeClass('active');
        var postID = '{{ThisPost.id}}';
        console.log(postID, postRate);
        $.ajax (
            {
                method: 'POST',
                url: '{% url "blog:add_point_in_post" %}',
                data: {
                    point: postRate,
                    id: postID,
                    csrfmiddlewaretoken: $('input[name=csrfmiddlewaretoken]').val(),
                    action: 'post',
                },
                success: function (json) {
                    console.log(json.status)
                    if (json.status)
                    {
                        Swal.fire({
                            icon: 'success',
                            title: 'موفق',
                            text: 'رای شما با موفقیت ثبت گردید',
                        })
                    }
                    else
                    {
                        Swal.fire({
                            icon: 'error',
                            title: 'ناموفق',
                            text: 'رای شما با مشکل مواجه گردید',
                        })
                    }
                },
                error: function (json) {
                    console.log(json.error);
                }
            }
        )
    })
    
</script>